(()=>{"use strict";class e{constructor(e,t){this.length=e,this.health=e,this.sunk=!1,this.id=t}hit(){this.health--,this.isSunk()}isSunk(){0===this.health&&(this.sunk=!0)}}new e(3,0);let t=!1,o=0;const i=new AbortController;class r{constructor(e,t){this.hit=!1,this.miss=!1,this.occupied=!1,this.x=e,this.y=t,this.shipId=null}receiveAttack(){this.hit=!0}}function c(e){const t=[];for(let e=0;e<7;e++)for(let o=0;o<7;o++)t[e]=[];for(let e=0;e<7;e++)for(let o=0;o<7;o++)t[e][o]=new r(e,o);if("player"==e){const e=document.querySelector(".gameboard");for(let t=0;t<7;t++)for(let o=0;o<7;o++){const i=document.createElement("div");i.classList.add("board-piece"),i.setAttribute("data-x",t),i.setAttribute("data-y",o),e.appendChild(i)}}else{const e=document.querySelector(".computer-gameboard");for(let t=0;t<7;t++)for(let o=0;o<7;o++){const i=document.createElement("div");i.classList.add("board-piece"),i.setAttribute("data-x",t),i.setAttribute("data-y",o),e.appendChild(i)}}return t}function n(e,t){const o=[].concat.apply([],t),i=Math.random()<.5?"horizontal":"vertical",r=function e(i,r){if("horizontal"===i){const c=Math.floor(Math.random()*o.length),n=o[c];if(!0===n.occupied||n.y+r.length>7)return e(i,r);if(2===r.length&&t[n.x][n.y+r.length-1].occupied)return e(i,r);if(3===r.length){if(t[n.x][n.y+r.length-1].occupied)return e(i,r);if(t[n.x][n.y+r.length-2].occupied)return e(i,r)}if(4===r.length){if(t[n.x][n.y+r.length-1].occupied)return e(i,r);if(t[n.x][n.y+r.length-2].occupied)return e(i,r);if(t[n.x][n.y+r.length-3].occupied)return e(i,r)}if(5===r.length){if(t[n.x][n.y+r.length-1].occupied)return e(i,r);if(t[n.x][n.y+r.length-2].occupied)return e(i,r);if(t[n.x][n.y+r.length-3].occupied)return e(i,r);if(t[n.x][n.y+r.length-4].occupied)return e(i,r)}return n}if("vertical"===i){const c=Math.floor(Math.random()*o.length),n=o[c];if(!0===n.occupied||n.x+r.length>7)return e(i,r);if(2===r.length&&t[n.x+r.length-1][n.y].occupied)return e(i,r);if(3===r.length){if(t[n.x+r.length-1][n.y].occupied)return e(i,r);if(t[n.x+r.length-2][n.y].occupied)return e(i,r)}if(4===r.length){if(t[n.x+r.length-1][n.y].occupied)return e(i,r);if(t[n.x+r.length-2][n.y].occupied)return e(i,r);if(t[n.x+r.length-3][n.y].occupied)return e(i,r)}if(5===r.length){if(t[n.x+r.length-1][n.y].occupied)return e(i,r);if(t[n.x+r.length-2][n.y].occupied)return e(i,r);if(t[n.x+r.length-3][n.y].occupied)return e(i,r);if(t[n.x+r.length-4][n.y].occupied)return e(i,r)}return n}}(i,e);if(r.occupied=!0,r.shipId=e.id,"vertical"===i)for(let o=0;o<e.length;o++)t[r.x+o][r.y].occupied=!0,t[r.x+o][r.y].shipId=e.id;if("horizontal"===i)for(let o=0;o<e.length;o++)t[r.x][r.y+o].occupied=!0,t[r.x][r.y+o].shipId=e.id}new r(0,0).occupied=!0;const l=document.querySelector("body"),a=document.querySelector(".start-game-button"),d=document.querySelector(".computer-gameboard");let s,u,h,p=[],g=[];a.addEventListener("click",(function(){console.log("game loop started"),console.log("computer gameboard",h),console.log("player gameboard",u),console.log("computer ships",g),console.log("player ships",p),h.forEach((e=>{e.forEach((e=>{const t=d.querySelector(`[data-x="${e.x}"][data-y="${e.y}"]`);t.addEventListener("click",(o=>{console.log("clicked"),console.log("piece",e),console.log("piece.occupied",e.occupied),e.occupied?(console.log("hit"),t.classList.add("hit")):(console.log("miss"),t.classList.add("miss"));const i=Math.floor(7*Math.random()),r=Math.floor(7*Math.random()),c=u[i][r];console.log("random piece",c),console.log("random piece.occupied",c.occupied);const n=document.querySelector(".gameboard").querySelector(`[data-x="${c.x}"][data-y="${c.y}"]`);c.occupied?(console.log("hit"),n.classList.add("hit")):(console.log("miss"),n.classList.add("miss"))}))}))}))})),l.onload=("Test Player",u=c("player"),s=new class{constructor(e){this.name=e,this.playerShips=[],this.createPlayerShips()}createPlayerShips(){const t=new e(5,1),o=new e(4,2),i=new e(3,3),r=new e(3,4),c=new e(2,5);this.playerShips.push(t,o,i,r,c)}placePlayerShips(e){let r="vertical";return document.querySelector(".toggle-button").addEventListener("click",(()=>{r="vertical"===r?"horizontal":"vertical"})),document.querySelectorAll(".board-piece").forEach((c=>{c.addEventListener("click",(()=>{const n=c.getAttribute("data-x"),l=c.getAttribute("data-y");console.log(`x: ${n}, y: ${l}`);const a=e[n][l];console.log(a),function(e,o,i,r){const{length:c}=e,{id:n}=e;if("vertical"===r){if(i.x+e.length>7||!0===i.occupied)return t=!1,void alert("Ship will not fit on board");if(2===e.length&&o[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(3===e.length){if(o[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x+e.length-2][i.y].occupied)return t=!1,void alert("Ships cannot overlap.")}if(4===e.length){if(o[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x+e.length-2][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x+e.length-3][i.y].occupied)return t=!1,void alert("Ships cannot overlap.")}if(5===e.length){if(o[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x+e.length-2][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x+e.length-3][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x+e.length-4][i.y].occupied)return t=!1,void alert("Ships cannot overlap.")}i.occupied=!0,i.shipId=n;for(let e=1;e<c;e+=1){const t=o[i.x+e][i.y];t.occupied=!0,t.shipId=n}t=!0}if("horizontal"===r){if(i.y+e.length>7||!0===i.occupied)return t=!1,void alert("Ship will not fit on board");if(2===e.length&&o[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(3===e.length){if(o[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x][i.y+e.length-2].occupied)return t=!1,void alert("Ships cannot overlap.")}if(4===e.length){if(o[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x][i.y+e.length-2].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x][i.y+e.length-3].occupied)return t=!1,void alert("Ships cannot overlap.")}if(5===e.length){if(o[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x][i.y+e.length-2].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x][i.y+e.length-3].occupied)return t=!1,void alert("Ships cannot overlap.");if(o[i.x][i.y+e.length-4].occupied)return t=!1,void alert("Ships cannot overlap.")}i.occupied=!0,i.shipId=n;for(let e=1;e<c;e+=1){const t=o[i.x][i.y+e];t.occupied=!0,t.shipId=n}t=!0}}(this.playerShips[o],e,a,r),function(e){e.forEach((e=>{e.forEach((e=>{e.occupied&&document.querySelector(`[data-x="${e.x}"][data-y="${e.y}"]`).classList.add("occupied")}))}))}(e),t&&o++,console.log("ship count: ",o),5===o&&(console.log("test if triggered"),i.abort(),document.querySelector(".toggle-button").remove(),document.querySelector(".start-game-button").style.visibility="visible")}),{signal:i.signal}),c.addEventListener("mouseover",(e=>{e.target.classList.add("hover");const t=c.getAttribute("data-x"),i=c.getAttribute("data-y");for(let e=1;e<this.playerShips[o].length;e++)"horizontal"===r?document.querySelector(`[data-x="${t}"][data-y="${Number(i)+e}"]`).classList.add("hover"):document.querySelector(`[data-x="${Number(t)+e}"][data-y="${i}"]`).classList.add("hover")}),{signal:i.signal}),c.addEventListener("mouseout",(e=>{e.target.classList.remove("hover");const t=c.getAttribute("data-x"),i=c.getAttribute("data-y");for(let e=1;e<this.playerShips[o].length;e++)"horizontal"===r?document.querySelector(`[data-x="${t}"][data-y="${Number(i)+e}"]`).classList.remove("hover"):document.querySelector(`[data-x="${Number(t)+e}"][data-y="${i}"]`).classList.remove("hover")}),{signal:i.signal})})),this.playerShips}}("Test Player"),p=s.placePlayerShips(u),h=c("computer"),g=function(t){const o=[new e(5,1),new e(4,2),new e(3,3),new e(3,4),new e(2,5)];for(let e=0;e<o.length;e++)n(o[e],t);return 17!==function(e){return[].concat(...e).filter((e=>!0===e.occupied))}(t).length&&alert("Computer ships not placed correctly"),o}(h),void h.forEach((e=>{e.forEach((e=>{e.occupied&&d.querySelector(`[data-x="${e.x}"][data-y="${e.y}"]`).classList.add("occupied")}))})))})();