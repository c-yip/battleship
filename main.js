(()=>{"use strict";class e{constructor(e,t){this.length=e,this.health=e,this.sunk=!1,this.id=t}hit(){this.health--,this.isSunk()}isSunk(){0===this.health&&(this.sunk=!0)}}new e(3,0);let t=!1,r=0;const i=new AbortController;class o{constructor(e,t){this.hit=!1,this.miss=!1,this.occupied=!1,this.x=e,this.y=t,this.shipId=null}receiveAttack(){this.hit=!0}}function n(e){const t=[];for(let e=0;e<7;e++)for(let r=0;r<7;r++)t[e]=[];for(let e=0;e<7;e++)for(let r=0;r<7;r++)t[e][r]=new o(e,r);if("player"==e){const e=document.querySelector(".gameboard");for(let t=0;t<7;t++)for(let r=0;r<7;r++){const i=document.createElement("div");i.classList.add("board-piece"),i.setAttribute("data-x",t),i.setAttribute("data-y",r),e.appendChild(i)}}else{const e=document.querySelector(".computer-gameboard");for(let t=0;t<7;t++)for(let r=0;r<7;r++){const i=document.createElement("div");i.classList.add("board-piece"),i.setAttribute("data-x",t),i.setAttribute("data-y",r),e.appendChild(i)}}return t}function c(e,t){!0!==e.occupied?e.miss=!0:(e.receiveAttack(),t.filter((t=>t.id===e.shipId))[0].hit())}function l(e,t){const r=[].concat.apply([],t),i=Math.random()<.5?"horizontal":"vertical",o=function e(i,o){if("horizontal"===i){const n=Math.floor(Math.random()*r.length),c=r[n];if(!0===c.occupied||c.y+o.length>7)return e(i,o);if(2===o.length&&t[c.x][c.y+o.length-1].occupied)return e(i,o);if(3===o.length){if(t[c.x][c.y+o.length-1].occupied)return e(i,o);if(t[c.x][c.y+o.length-2].occupied)return e(i,o)}if(4===o.length){if(t[c.x][c.y+o.length-1].occupied)return e(i,o);if(t[c.x][c.y+o.length-2].occupied)return e(i,o);if(t[c.x][c.y+o.length-3].occupied)return e(i,o)}if(5===o.length){if(t[c.x][c.y+o.length-1].occupied)return e(i,o);if(t[c.x][c.y+o.length-2].occupied)return e(i,o);if(t[c.x][c.y+o.length-3].occupied)return e(i,o);if(t[c.x][c.y+o.length-4].occupied)return e(i,o)}return c}if("vertical"===i){const n=Math.floor(Math.random()*r.length),c=r[n];if(!0===c.occupied||c.x+o.length>7)return e(i,o);if(2===o.length&&t[c.x+o.length-1][c.y].occupied)return e(i,o);if(3===o.length){if(t[c.x+o.length-1][c.y].occupied)return e(i,o);if(t[c.x+o.length-2][c.y].occupied)return e(i,o)}if(4===o.length){if(t[c.x+o.length-1][c.y].occupied)return e(i,o);if(t[c.x+o.length-2][c.y].occupied)return e(i,o);if(t[c.x+o.length-3][c.y].occupied)return e(i,o)}if(5===o.length){if(t[c.x+o.length-1][c.y].occupied)return e(i,o);if(t[c.x+o.length-2][c.y].occupied)return e(i,o);if(t[c.x+o.length-3][c.y].occupied)return e(i,o);if(t[c.x+o.length-4][c.y].occupied)return e(i,o)}return c}}(i,e);if(o.occupied=!0,o.shipId=e.id,"vertical"===i)for(let r=0;r<e.length;r++)t[o.x+r][o.y].occupied=!0,t[o.x+r][o.y].shipId=e.id;if("horizontal"===i)for(let r=0;r<e.length;r++)t[o.x][o.y+r].occupied=!0,t[o.x][o.y+r].shipId=e.id}new o(0,0).occupied=!0;const a=document.querySelector("body"),d=document.querySelector(".start-game-button"),u=document.querySelector(".computer-gameboard");let s,h,p,y=[],f=[],g=0,v=0,x=!1;const m=new AbortController;function S(e){x=!0,document.querySelector(".score-board").style.visibility="hidden";const t=document.querySelector(".end-game-modal"),r=document.querySelector(".modal-title");t.style.display="block",r.textContent=e?"You Win!":"You Lose!",document.querySelector(".restart-game-button").addEventListener("click",(()=>{location.reload()}))}d.addEventListener("click",(function(){d.style.visibility="hidden",p.forEach((e=>{e.forEach((e=>{const t=u.querySelector(`[data-x="${e.x}"][data-y="${e.y}"]`);t.addEventListener("click",(r=>{c(e,f),e.occupied?(t.classList.add("hit"),g++):t.classList.add("miss");const i=function e(){const t=Math.floor(7*Math.random()),r=Math.floor(7*Math.random()),i=h[t][r];return i.hit||i.miss?e():i}(),o=document.querySelector(".gameboard").querySelector(`[data-x="${i.x}"][data-y="${i.y}"]`);c(i,y),i.occupied?(o.classList.add("hit"),v++):o.classList.add("miss"),document.querySelector(".player-score").textContent=`Player Score: ${g}`,document.querySelector(".computer-score").textContent=`Computer Score: ${v}`,5===f.filter((e=>!0===e.sunk)).length&&S(!0),5===y.filter((e=>!0===e.sunk)).length&&S(!1),x&&m.abort()}),{once:!0,signal:m.signal})}))}))})),a.onload=("Test Player",h=n("player"),s=new class{constructor(e){this.name=e,this.playerShips=[],this.createPlayerShips()}createPlayerShips(){const t=new e(5,1),r=new e(4,2),i=new e(3,3),o=new e(3,4),n=new e(2,5);this.playerShips.push(t,r,i,o,n)}placePlayerShips(e){let o="vertical";return document.querySelector(".toggle-button").addEventListener("click",(()=>{o="vertical"===o?"horizontal":"vertical"})),document.querySelectorAll(".board-piece").forEach((n=>{n.addEventListener("click",(()=>{const c=n.getAttribute("data-x"),l=n.getAttribute("data-y"),a=e[c][l];(function(e,r,i,o){const{length:n}=e,{id:c}=e;if("vertical"===o){if(i.x+e.length>7||!0===i.occupied)return t=!1,void alert("Ship will not fit on board");if(2===e.length&&r[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(3===e.length){if(r[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x+e.length-2][i.y].occupied)return t=!1,void alert("Ships cannot overlap.")}if(4===e.length){if(r[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x+e.length-2][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x+e.length-3][i.y].occupied)return t=!1,void alert("Ships cannot overlap.")}if(5===e.length){if(r[i.x+e.length-1][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x+e.length-2][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x+e.length-3][i.y].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x+e.length-4][i.y].occupied)return t=!1,void alert("Ships cannot overlap.")}i.occupied=!0,i.shipId=c;for(let e=1;e<n;e+=1){const t=r[i.x+e][i.y];t.occupied=!0,t.shipId=c}t=!0}if("horizontal"===o){if(i.y+e.length>7||!0===i.occupied)return t=!1,void alert("Ship will not fit on board");if(2===e.length&&r[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(3===e.length){if(r[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x][i.y+e.length-2].occupied)return t=!1,void alert("Ships cannot overlap.")}if(4===e.length){if(r[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x][i.y+e.length-2].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x][i.y+e.length-3].occupied)return t=!1,void alert("Ships cannot overlap.")}if(5===e.length){if(r[i.x][i.y+e.length-1].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x][i.y+e.length-2].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x][i.y+e.length-3].occupied)return t=!1,void alert("Ships cannot overlap.");if(r[i.x][i.y+e.length-4].occupied)return t=!1,void alert("Ships cannot overlap.")}i.occupied=!0,i.shipId=c;for(let e=1;e<n;e+=1){const t=r[i.x][i.y+e];t.occupied=!0,t.shipId=c}t=!0}})(this.playerShips[r],e,a,o),function(e){e.forEach((e=>{e.forEach((e=>{e.occupied&&document.querySelector(`[data-x="${e.x}"][data-y="${e.y}"]`).classList.add("occupied")}))}))}(e),t&&r++,5===r&&(i.abort(),document.querySelector(".toggle-button").remove(),document.querySelector(".start-game-button").style.visibility="visible")}),{signal:i.signal}),n.addEventListener("mouseover",(e=>{e.target.classList.add("hover");const t=n.getAttribute("data-x"),i=n.getAttribute("data-y");for(let e=1;e<this.playerShips[r].length;e++)"horizontal"===o?document.querySelector(`[data-x="${t}"][data-y="${Number(i)+e}"]`).classList.add("hover"):document.querySelector(`[data-x="${Number(t)+e}"][data-y="${i}"]`).classList.add("hover")}),{signal:i.signal}),n.addEventListener("mouseout",(e=>{e.target.classList.remove("hover");const t=n.getAttribute("data-x"),i=n.getAttribute("data-y");for(let e=1;e<this.playerShips[r].length;e++)"horizontal"===o?document.querySelector(`[data-x="${t}"][data-y="${Number(i)+e}"]`).classList.remove("hover"):document.querySelector(`[data-x="${Number(t)+e}"][data-y="${i}"]`).classList.remove("hover")}),{signal:i.signal})})),this.playerShips}}("Test Player"),y=s.placePlayerShips(h),p=n("computer"),void(f=function(t){const r=[new e(5,1),new e(4,2),new e(3,3),new e(3,4),new e(2,5)];for(let e=0;e<r.length;e++)l(r[e],t);return 17!==function(e){return[].concat(...e).filter((e=>!0===e.occupied))}(t).length&&alert("Computer ships not placed correctly"),r}(p)))})();